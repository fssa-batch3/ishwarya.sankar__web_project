<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N Appointment</title>
    <link rel="stylesheet" href="../assests/style.css/card.css">
</head>
<body>
    <form id="main">
        <div class="wrapper">
            <div class="title"> Book Appointment</div>
            <!-- <form action="#"> -->
                <div class="user-details">
                    <div class="input-box">
                        <span class="details"></span>
                        <input type="text" placeholder="Full Name"  id="username" value="ishu">
                    </div>
                    <div class="input-box">
                        <span class="details" ></span>
                        <input type="email" placeholder="Email" id="email" disabled >
                    </div>
                    <div class="input-box">
                        <span class="details" ></span>
                        <input type="number" placeholder="Phone Number" id="mobile" value="99709876543" >
                    </div>
                    <div class="input-box">
                        <span class="details"></span>
                        <input type="text" placeholder="City" id="city" value="chennai">
                    </div>
                    <div class="input-box">
                        <span class="details" ></span>
                        <input type="text"     placeholder="Address"id="address" value="3rd thiruvengadam street" >
                    </div>
                    <div class="form-group row">
                        <label class="col-sm-4 col-lg-4" id="dates">
                          Date
                        </label>
                        <div class="col-sm-8 col-lg-8">
                            <input type="date"id="date"class="form-control">
                        </div>
                    </div>
                    <!---->
                    <div class="form-group row">
                        <label class="col-sm-4 col-lg-4">
                           Time
                        </label>
                        <div class="col-sm-8 col-lg-8">
                            <input type="time"id="time"class="form-control">
                           </div>
                    </div>
                  
                   
                </div>
                <div class="submit_btn">
                    <button  onclick="validateDate()" class="button" value="Register" >Register</button>
                </div>
            </form>

<script>

   
let date = new URLSearchParams(window.location.search);
            let id = date.get("doc_id");
            console.log(id);

            let log_user = JSON.parse(localStorage.getItem("data"))

            document.getElementById("email").value = log_user

   
let appointments_arr =[]
let appointments_obj= {}
let form = document.getElementById("main");

form.addEventListener("submit", function (event){
    event.preventDefault();
let fullname = document.getElementById("username").value;
let email = document.getElementById("email").value;
let phonenumber = document.getElementById("mobile").value;
let city = document.getElementById("city").value;
let address = document.getElementById("address").value;
let date = document.getElementById("date").value;
let time = document.getElementById("time").value;

let uuid = self.crypto.randomUUID()


appointments_obj["fullname"] = fullname
appointments_obj["email"] = email.toLowerCase()
appointments_obj["phonenumber"] = phonenumber
appointments_obj["city"] = city
appointments_obj["address"] = address
appointments_obj["date"] = date
appointments_obj["time"] = time
appointments_obj["approved"] = false
appointments_obj["uuid"] = uuid
appointments_obj["docId"] = id

            let slt = document.getElementById("option")
          console.log(appointments_obj);
if(window.localStorage.getItem("appointments_arr") === null){
    appointments_arr.push(appointments_obj)
window.localStorage.setItem("appointments_arr", JSON.stringify(appointments_arr));
alert("Appoinment Successfully appointed")
window.location.href="../pages/newappo.html";
}else{
let card_data = JSON.parse(window.localStorage.getItem("appointments_arr"));
card_data.push(appointments_obj)
window.localStorage.setItem("appointments_arr",JSON.stringify(card_data))
// alert("Appoinment Successfully appointed")
window.location.href="../index.html";
}
});
let dataObj= JSON.parse(localStorage.getItem("data"));
              let objObject=JSON.parse(localStorage.getItem("obj"));
              console.log(dataObj);
              console.log(objObject);
              let get = objObject.find(function (obj) {
        let checkmail = obj["useremail"];
        if (dataObj === checkmail) {
          return true;
        }
      });

      console.log(get)
      var today = new Date();
        var futureDate = new Date();
        futureDate.setDate(today.getDate() + 7);
        var futureDateString = futureDate.toISOString().slice(0, 10);
        var dateInput = document.getElementById('date');
        dateInput.setAttribute('min', today.toISOString().slice(0, 10));
        dateInput.setAttribute('max', futureDateString);

var timeInput = document.getElementById('time');
        timeInput.addEventListener('input', function () {
            var selectedTime = new Date('2000-01-01T' + this.value + '7:00');
            var minTime = new Date('2000-01-01T08:00:00');
            var maxTime = new Date('2000-01-01T20:00:00');
            if (selectedTime < minTime || selectedTime > maxTime) {
                timeInput.setCustomValidity('Please select a time between 8 am and 8 pm.');
            } else {
                timeInput.setCustomValidity('');
            }
        });



        function validateDate(){
           

            let whole = JSON.parse(localStorage.getItem("whole"));
            let findedWhole = whole.find((F)=> F.new_id == id);
            console.log(findedWhole);
            findedWhole["Booked"] = true;
            let findedWholeIndex = whole.indexOf(findedWhole);
            whole[findedWholeIndex]=findedWhole;
            localStorage.setItem("whole",JSON.stringify(whole))

        }






</script>
        </body>
</html>
